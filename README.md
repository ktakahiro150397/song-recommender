# Song Recommender

æ›²èª¿ãŒä¼¼ã¦ã„ã‚‹æ¥½æ›²ã‚’ãƒ™ã‚¯ãƒˆãƒ«DBã‹ã‚‰æ¤œç´¢ã—ã€é¡ä¼¼åº¦ã®é«˜ã„ã‚‚ã®ã‚’å‡ºåŠ›ã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚

> ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã‚„ã‚¸ãƒ£ãƒ³ãƒ«ã§ã¯ãªãã€**éŸ³å£°ç‰¹å¾´é‡ï¼ˆæ›²èª¿ï¼‰** ã«åŸºã¥ã„ãŸãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰ã‚’è¡Œã„ã¾ã™ã€‚

## æ¦‚è¦

```
éŸ³æ¥½ãƒ•ã‚¡ã‚¤ãƒ« â†’ éŸ³å£°ç‰¹å¾´é‡æŠ½å‡º â†’ ãƒ™ã‚¯ãƒˆãƒ«åŒ– â†’ ãƒ™ã‚¯ãƒˆãƒ«DBç™»éŒ²
                                              â†“
æ¤œç´¢ã‚¯ã‚¨ãƒªæ¥½æ›² â†’ åŒæ§˜ã«ãƒ™ã‚¯ãƒˆãƒ«åŒ– â†’ é¡ä¼¼ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ â†’ çµæœå‡ºåŠ›
                                              â†“
                              YouTube Music ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆè‡ªå‹•ä½œæˆ
```

## ä¸»ãªæ©Ÿèƒ½

- **ğŸ” æ›²èª¿ãŠã™ã™ã‚ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ**: æŒ‡å®šã—ãŸæ¥½æ›²ã‹ã‚‰ä¼¼ãŸæ›²ã‚’é€£é–çš„ã«æ¤œç´¢ã—ã¦ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚’ä½œæˆ
- **ğŸµ å€‹åˆ¥æ›²æ¤œç´¢**: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¥½æ›²ã‚’æ¤œç´¢ãƒ»ä¸€è¦§è¡¨ç¤º
- **ğŸ“¤ æ¥½æ›²ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: è¤‡æ•°ã®æ¥½æ›²ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- **ğŸ—„ï¸ DBãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç®¡ç†ãƒ»æ›²ã®å‰Šé™¤ãƒ»æ¥½æ›²ç™»éŒ²
- **ğŸ“º YouTubeãƒãƒ£ãƒ³ãƒãƒ«ç™»éŒ²**: YouTube Musicãƒãƒ£ãƒ³ãƒãƒ«ã®URLç®¡ç†
- **ğŸ“‹ ãƒãƒ£ãƒ³ãƒãƒ«ä¸€è¦§**: ç™»éŒ²ãƒãƒ£ãƒ³ãƒãƒ«ã®ç¢ºèªãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆç”Ÿæˆ

## æŠ½å‡ºã™ã‚‹éŸ³å£°ç‰¹å¾´é‡

| ç‰¹å¾´é‡ | æ¬¡å…ƒ | æ„å‘³ |
|--------|------|------|
| MFCC | 20 | éŸ³è‰²ãƒ»è³ªæ„Ÿï¼ˆãƒ¡ãƒ«å‘¨æ³¢æ•°ã‚±ãƒ—ã‚¹ãƒˆãƒ©ãƒ ä¿‚æ•°ï¼‰ |
| MFCC Delta | 20 | éŸ³è‰²ã®æ™‚é–“å¤‰åŒ– |
| Chroma | 12 | å’ŒéŸ³ãƒ»èª¿æ€§ï¼ˆ12éŸ³éšã®åˆ†å¸ƒï¼‰ |
| Tonnetz | 6 | å’Œå£°çš„é–¢ä¿‚ï¼ˆã‚³ãƒ¼ãƒ‰é€²è¡Œï¼‰ |
| Spectral Contrast | 7 | éŸ³ã®è°·ã¨å±±ï¼ˆã‚¸ãƒ£ãƒ³ãƒ«è­˜åˆ¥ï¼‰ |
| Spectral Centroid | 1 | éŸ³ã®æ˜ã‚‹ã• |
| Spectral Rolloff | 1 | é«˜å‘¨æ³¢æˆåˆ†ã®å‰²åˆ |
| Spectral Bandwidth | 1 | éŸ³ã®åºƒãŒã‚Š |
| Spectral Flatness | 1 | ãƒã‚¤ã‚ºã£ã½ã•ï¼ˆé›»å­éŸ³ vs ç”ŸéŸ³ï¼‰ |
| Zero Crossing Rate | 1 | ãƒã‚¤ã‚¸ãƒ¼ã•ãƒ»æ‰“æ¥½å™¨æ„Ÿ |
| RMS Energy | 1 | éŸ³é‡ãƒ¬ãƒ™ãƒ« |
| Tempo (BPM) | 1 | æ›²ã®é€Ÿã• |

## ç‰¹å¾´é‡ãƒ¢ãƒ¼ãƒ‰

ç”¨é€”ã«å¿œã˜ã¦3ã¤ã®ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠå¯èƒ½ï¼š

| ãƒ¢ãƒ¼ãƒ‰ | æ¬¡å…ƒæ•° | å«ã¾ã‚Œã‚‹ç‰¹å¾´é‡ | ç”¨é€” |
|--------|--------|---------------|------|
| **minimal** | 15 | Chroma, Centroid, RMS, Tempo | ãƒ†ãƒ³ãƒãƒ»æ˜ã‚‹ã•é‡è¦– |
| **balanced** | 33 | â†‘ + MFCC(10), Contrast, Bandwidth | æ±ç”¨çš„ï¼ˆæ¨å¥¨ï¼‰ |
| **full** | 72 | å…¨ç‰¹å¾´é‡ | ç´°ã‹ã„é•ã„ã‚’è¦‹ãŸã„ |

## è·é›¢é–¢æ•°

| è·é›¢é–¢æ•° | èª¬æ˜ | æ¨å¥¨ |
|----------|------|------|
| **cosine** | ãƒ™ã‚¯ãƒˆãƒ«ã®å‘ãï¼ˆè§’åº¦ï¼‰ã§æ¯”è¼ƒã€‚éŸ³é‡å·®ã‚’å¸åã§ãã‚‹ | âœ… |
| l2 | ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰è·é›¢ã€‚çµ¶å¯¾çš„ãªä½ç½®ã§æ¯”è¼ƒ | |
| ip | å†…ç© | |

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ç”¨é€” | ãƒ©ã‚¤ãƒ–ãƒ©ãƒª |
|------|-----------|
| éŸ³å£°ç‰¹å¾´é‡æŠ½å‡º | librosa |
| ãƒ™ã‚¯ãƒˆãƒ«DB | ChromaDBï¼ˆãƒ­ãƒ¼ã‚«ãƒ«æ°¸ç¶šåŒ–ï¼‰ |
| YouTube Musicé€£æº | ytmusicapi |
| Webã‚¢ãƒ—ãƒª | Streamlit |
| ãƒ‡ãƒ¼ã‚¿å‡¦ç† | pandas |
| æ•°å€¤è¨ˆç®— | numpy |
| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç† | uv |

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
song-recommender/
â”œâ”€â”€ app.py                        # Streamlit ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒª
â”œâ”€â”€ main.py                       # é€£é–æ¤œç´¢ãƒ»æ›²ä¸€è¦§è¡¨ç¤ºCLI
â”œâ”€â”€ register_songs.py             # éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ™ã‚¯ãƒˆãƒ«DBç™»éŒ²
â”œâ”€â”€ create_playlist_from_chain.py # é€£é–æ¤œç´¢â†’YouTube Musicãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆä½œæˆ
â”œâ”€â”€ create_dl_script_from_yt.py   # YouTube Musicâ†’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆç”Ÿæˆ
â”œâ”€â”€ db_maintenance.py             # DBãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ç”¨Streamlitã‚¢ãƒ—ãƒªï¼ˆå˜ç‹¬èµ·å‹•ç”¨ï¼‰
â”œâ”€â”€ test_ytmusic.py               # YouTube Music API ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ config.py                     # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“è¨­å®š
â”œâ”€â”€ browser.json                  # YouTube Musicèªè¨¼ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ feature_extractor.py      # éŸ³å£°ç‰¹å¾´é‡æŠ½å‡º
â”‚   â”œâ”€â”€ db_manager.py             # ãƒ™ã‚¯ãƒˆãƒ«DBæ“ä½œ
â”‚   â”œâ”€â”€ ytmusic_manager.py        # YouTube Music APIæ“ä½œ
â”‚   â””â”€â”€ channel_db.py             # YouTubeãƒãƒ£ãƒ³ãƒãƒ«DBç®¡ç†ï¼ˆSQLiteï¼‰
â”œâ”€â”€ pages/                        # Streamlit ãƒãƒ«ãƒãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ 1_ğŸ”_æ›²èª¿ãŠã™ã™ã‚ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ.py
â”‚   â”œâ”€â”€ 2_ğŸµ_å€‹åˆ¥æ›²æ¤œç´¢.py
â”‚   â”œâ”€â”€ 3_ğŸ“¤_æ¥½æ›²ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰.py
â”‚   â”œâ”€â”€ 4_ğŸ—„ï¸_DBãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹.py
â”‚   â”œâ”€â”€ 5_ğŸ—„ï¸_DBãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹_æ¥½æ›²ç™»éŒ².py
â”‚   â”œâ”€â”€ 6_ğŸ“º_YouTubeãƒãƒ£ãƒ³ãƒãƒ«ç™»éŒ².py
â”‚   â””â”€â”€ 7_ğŸ“‹_ãƒãƒ£ãƒ³ãƒãƒ«ä¸€è¦§.py
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ chroma_db_cos_minimal/    # minimal ãƒ¢ãƒ¼ãƒ‰DB
â”‚   â”œâ”€â”€ chroma_db_cos_balance/    # balanced ãƒ¢ãƒ¼ãƒ‰DB
â”‚   â”œâ”€â”€ chroma_db_cos_full/       # full ãƒ¢ãƒ¼ãƒ‰DB
â”‚   â””â”€â”€ youtube_channels.db       # ãƒãƒ£ãƒ³ãƒãƒ«ç®¡ç†DBï¼ˆSQLiteï¼‰
â”œâ”€â”€ upload/
â”‚   â””â”€â”€ data/                     # ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜å…ˆ
â”œâ”€â”€ output_scripts/               # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆå‡ºåŠ›å…ˆ
â”œâ”€â”€ .vscode/
â”‚   â””â”€â”€ tasks.json                # VS Codeã‚¿ã‚¹ã‚¯è¨­å®š
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ pyproject.toml
â””â”€â”€ README.md
```

## ä½¿ã„æ–¹

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# Web/æ¤œç´¢ã ã‘ã®æœ€å°æ§‹æˆ
uv sync

# ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç™»éŒ²ï¼ˆMERT/AST ãªã©ï¼‰ã‚‚ä½¿ã†å ´åˆ
uv sync --extra segment
```

---

### Streamlit Webã‚¢ãƒ—ãƒªã®èµ·å‹•

```bash
# Webã‚¢ãƒ—ãƒªã‚’èµ·å‹•
streamlit run app.py

# ã¾ãŸã¯ uv çµŒç”±ã§èµ·å‹•
uv run streamlit run app.py
```

â†’ http://localhost:8501 ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½

---

### 1. æ¥½æ›²ã®ç™»éŒ²

éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ™ã‚¯ãƒˆãƒ«DBã«ç™»éŒ²ã—ã¾ã™ã€‚

```bash
# ç›´åˆ—å‡¦ç†ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
uv run register_songs.py

# ThreadPoolä¸¦åˆ—å‡¦ç†
uv run register_songs.py --parallel thread

# ProcessPoolä¸¦åˆ—å‡¦ç†ï¼ˆCPUåŠ¹ç‡â—ã€æ¨å¥¨ï¼‰
uv run register_songs.py --parallel process
uv run register_songs.py -p process  # çŸ­ç¸®å½¢
```

ç™»éŒ²å¯¾è±¡ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ `register_songs.py` å†…ã® `SOUND_DIRS` ã§è¨­å®šã—ã¾ã™ã€‚

---

### 2. é€£é–æ¤œç´¢

æŒ‡å®šã—ãŸæ›²ã‹ã‚‰é¡ä¼¼æ›²ã‚’é€£é–çš„ã«è¾¿ã‚Šã¾ã™ã€‚

```bash
# ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§é–‹å§‹æ›²ã‚’æ¤œç´¢ã—ã¦é€£é–æ¤œç´¢ã‚’å®Ÿè¡Œ
uv run main.py "ãƒ•ã‚§ã‚¹ã‚¿"

# è¡¨ç¤ºæ›²æ•°ã‚’æŒ‡å®šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 60æ›²ï¼‰
uv run main.py "SOS" --count 30
uv run main.py "SOS" -n 30

# ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã§çµã‚Šè¾¼ã¿ï¼ˆéƒ¨åˆ†ä¸€è‡´ï¼‰
uv run main.py "SOS" --artist "YOASOBI"
uv run main.py "SOS" -a "å®‡å¤šç”°"
```

è¤‡æ•°ã®æ›²ãŒãƒ’ãƒƒãƒˆã—ãŸå ´åˆã¯å¯¾è©±çš„ã«é¸æŠã§ãã¾ã™ã€‚

---

### 3. æ›²ã®æ¤œç´¢ãƒ»ä¸€è¦§è¡¨ç¤º

ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§ç™»éŒ²æ¸ˆã¿ã®æ›²ã‚’æ¤œç´¢ã—ã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä»˜ãã§ä¸€è¦§è¡¨ç¤ºã—ã¾ã™ã€‚

```bash
uv run main.py --list "ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"
uv run main.py -l "ã‚¢ã‚¤ãƒã‚¹"
```

---

### 4. YouTube Music ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆä½œæˆ

é€£é–æ¤œç´¢ã®çµæœã‚’YouTube Musicã®ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã¨ã—ã¦è‡ªå‹•ä½œæˆã—ã¾ã™ã€‚

```bash
# åŸºæœ¬çš„ãªä½¿ã„æ–¹
uv run create_playlist_from_chain.py "æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"

# ã‚ªãƒ—ã‚·ãƒ§ãƒ³æŒ‡å®š
uv run create_playlist_from_chain.py "ãƒ•ã‚§ã‚¹ã‚¿" --count 30 --name "ãƒã‚¤ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ"
```

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|-----------|------|-----------|
| `keyword` | é–‹å§‹æ›²ã®æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ | ï¼ˆå¿…é ˆï¼‰ |
| `--count`, `-n` | ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã«è¿½åŠ ã™ã‚‹æ›²æ•° | 30 |
| `--name` | ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå | "æ›²èª¿ãƒªã‚³ãƒ¡ãƒ³ãƒ‰ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ" |

#### å‡¦ç†ãƒ•ãƒ­ãƒ¼

1. ãƒ™ã‚¯ãƒˆãƒ«DBã‹ã‚‰é–‹å§‹æ›²ã®é¡ä¼¼æ›²ã‚’é€£é–çš„ã«æ¢ç´¢
2. ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰æ›²åã‚’æŠ½å‡ºã—ã¦æ¤œç´¢ã‚¯ã‚¨ãƒªã‚’ç”Ÿæˆ
3. YouTube Music APIã§æ¥½æ›²ã‚’æ¤œç´¢
4. ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚’ä½œæˆï¼ˆæ—¢å­˜ãŒã‚ã‚Œã°å‰Šé™¤ã—ã¦å†ä½œæˆï¼‰
5. Descriptionã«å‡¦ç†æ—¥ã¨é–‹å§‹æ›²ã‚’è¨˜è¼‰

---

### 5. YouTube Music API ãƒ†ã‚¹ãƒˆ

```bash
# æ¥ç¶šãƒ†ã‚¹ãƒˆ
uv run test_ytmusic.py --test

# ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆä¸€è¦§
uv run test_ytmusic.py --list

# æ¤œç´¢ãƒ†ã‚¹ãƒˆ
uv run test_ytmusic.py --search

# ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆä½œæˆãƒ†ã‚¹ãƒˆ
uv run test_ytmusic.py --create "ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ"

# ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå‰Šé™¤
uv run test_ytmusic.py --delete "PLAYLIST_ID"
```

---

### 6. YouTubeã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆç”Ÿæˆ

ç™»éŒ²æ¸ˆã¿YouTubeãƒãƒ£ãƒ³ãƒãƒ«ã®æ¥½æ›²ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```bash
# ãƒãƒ£ãƒ³ãƒãƒ«IDã‚’æŒ‡å®š
uv run create_dl_script_from_yt.py --url "UCxxxxxxxxxx"

# å…¨ãƒãƒ£ãƒ³ãƒãƒ«ã‚’å¯¾è±¡ã«ç”Ÿæˆ
uv run create_dl_script_from_yt.py --all
```

å‡ºåŠ›ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ `output_scripts/{ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—}/` ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚

---

## VS Code ã‚¿ã‚¹ã‚¯

VS Codeã®ã‚¿ã‚¹ã‚¯æ©Ÿèƒ½ï¼ˆ`Ctrl+Shift+B` ã¾ãŸã¯ `Terminal > Run Task`ï¼‰ã‹ã‚‰å„å‡¦ç†ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚

| ã‚¿ã‚¹ã‚¯å | èª¬æ˜ | å…¥åŠ› |
|---------|------|------|
| **Register Songs to DB** | éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ™ã‚¯ãƒˆãƒ«DBã«ç™»éŒ² | ä¸¦åˆ—ãƒ¢ãƒ¼ãƒ‰ï¼ˆnone/thread/processï¼‰ |
| **Run Chain Search** | é€£é–æ¤œç´¢ã‚’å®Ÿè¡Œ | æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€è¡¨ç¤ºæ›²æ•° |
| **List Songs by Keyword** | ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ›²ã‚’æ¤œç´¢ãƒ»ä¸€è¦§è¡¨ç¤º | æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ |
| **Create Playlist from Chain Search** | é€£é–æ¤œç´¢â†’YouTube Musicãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆä½œæˆ | æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€æ›²æ•°ã€ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå |
| **Test YouTube Music Connection** | YouTube Music APIã®æ¥ç¶šãƒ†ã‚¹ãƒˆ | ãªã— |
| **Create Playlist from Chain Search** | é€£é–æ¤œç´¢â†’YouTube Musicãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆä½œæˆ | æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€æ›²æ•°ã€ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå |
| **Test YouTube Music Connection** | YouTube Music APIã®æ¥ç¶šãƒ†ã‚¹ãƒˆ | ãªã— |

### ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œæ–¹æ³•

1. `Ctrl+Shift+P` ã§ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã‚’é–‹ã
2. `Tasks: Run Task` ã‚’é¸æŠ
3. å®Ÿè¡Œã—ãŸã„ã‚¿ã‚¹ã‚¯ã‚’é¸æŠ
4. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å¾“ã£ã¦å…¥åŠ›å€¤ã‚’è¨­å®š

---

## Pythonã‹ã‚‰ã®åˆ©ç”¨

```python
from core.db_manager import SongVectorDB
from core.feature_extractor import FeatureExtractor

# DBãƒ»æŠ½å‡ºå™¨ã®åˆæœŸåŒ–
db = SongVectorDB(db_path="data/chroma_db_cos_balance", distance_fn="cosine")
extractor = FeatureExtractor(duration=90, mode="balanced")

# æ¥½æ›²ã‚’ç™»éŒ²
embedding = extractor.extract_to_vector("song.wav")
db.add_song(song_id="song.wav", embedding=embedding, metadata={"filename": "song.wav"})

# é¡ä¼¼æ¥½æ›²ã‚’æ¤œç´¢
song = db.get_song("song.wav")
results = db.search_similar(query_embedding=song["embedding"], n_results=5)
```

---

## é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚º

- [x] **Phase 1**: librosa + ChromaDB ã§åŸºæœ¬å®Ÿè£…ï¼ˆMVPï¼‰
- [x] **Phase 2**: YouTube Musicé€£æºï¼ˆãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆè‡ªå‹•ä½œæˆï¼‰
- [x] **Phase 2.5**: CLIå¼•æ•°å¯¾å¿œãƒ»VS Codeã‚¿ã‚¹ã‚¯çµ±åˆ
- [x] **Phase 3**: Docker + Cloudflared ã§å¤–éƒ¨å…¬é–‹
- [x] **Phase 3.5**: Streamlit Webã‚¢ãƒ—ãƒªåŒ–ï¼ˆãƒãƒ«ãƒãƒšãƒ¼ã‚¸å¯¾å¿œï¼‰
- [x] **Phase 4**: YouTubeãƒãƒ£ãƒ³ãƒãƒ«ç®¡ç†ãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆç”Ÿæˆ
- [ ] **Phase 5**: ç²¾åº¦å‘ä¸ŠãŒå¿…è¦ãªå ´åˆã€CLAP / OpenL3 ç­‰ã®æ·±å±¤å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã‚’å°å…¥

---

## Docker ã§å®Ÿè¡Œ

### å‰ææ¡ä»¶

- Docker / Docker Compose ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿
- Cloudflare ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆå¤–éƒ¨å…¬é–‹ã™ã‚‹å ´åˆï¼‰

### ãƒ­ãƒ¼ã‚«ãƒ«ã§èµ·å‹•ï¼ˆDocker ã®ã¿ï¼‰

```bash
# ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦èµ·å‹•
docker compose up --build -d song-recommender

# ãƒ­ã‚°ã‚’ç¢ºèª
docker compose logs -f song-recommender
```

â†’ http://localhost:8501 ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½

### Cloudflared ã§å¤–éƒ¨å…¬é–‹

1. **Cloudflare Zero Trust ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ãƒˆãƒ³ãƒãƒ«ã‚’ä½œæˆ**
   - https://one.dash.cloudflare.com/ ã«ã‚¢ã‚¯ã‚»ã‚¹
   - `Access` â†’ `Tunnels` â†’ `Create a tunnel`
   - ãƒˆãƒ³ãƒãƒ«åã‚’è¨­å®šã—ã€ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—

2. **Public Hostname ã‚’è¨­å®š**
   - ãƒˆãƒ³ãƒãƒ«è¨­å®šã§ `Public Hostname` ã‚’è¿½åŠ 
   - Subdomain: ä»»æ„ï¼ˆä¾‹: `song-recommender`ï¼‰
   - Domain: æ‰€æœ‰ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’é¸æŠ
   - Service: `http://song-recommender:8501`

3. **ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š**
   ```bash
   # .env ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
   cp .env.example .env
   
   # ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®š
   # .env ã‚’ç·¨é›†ã—ã¦ CLOUDFLARE_TUNNEL_TOKEN ã‚’è¨­å®š
   ```

4. **èµ·å‹•**
   ```bash
   docker compose up --build -d
   
   # ãƒ­ã‚°ã‚’ç¢ºèª
   docker compose logs -f
   ```

â†’ è¨­å®šã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆä¾‹: `https://song-recommender.yourdomain.com`ï¼‰ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½

### ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–

Docker Compose ã§ã¯ä»¥ä¸‹ã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ãŒãƒã‚¦ãƒ³ãƒˆã•ã‚Œã¾ã™ï¼š

| ãƒ›ã‚¹ãƒˆ | ã‚³ãƒ³ãƒ†ãƒŠ | ç”¨é€” |
|--------|----------|------|
| `./data/` | `/app/data/` | ChromaDBï¼ˆãƒ™ã‚¯ãƒˆãƒ«DBï¼‰ |
| `./upload/` | `/app/upload/` | ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ« |
| `./oauth.json` | `/app/oauth.json` | YouTube Musicèªè¨¼ |
| `./browser.json` | `/app/browser.json` | YouTube Musicèªè¨¼ |

### ã‚³ãƒ³ãƒ†ãƒŠã®åœæ­¢

```bash
docker compose down
```

